<!-- Breadcrumb Begin -->
<div class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__links">
                    <a href="/">
                        <i class="fa fa-home"></i>
                        Home</a>
                    <span>Checkout</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->

<!-- Checkout Section Begin -->
<section class="checkout spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h6 class="coupon__link">
                    <span class="icon_tag_alt"></span>
                    <a href="#">Have a coupon?</a>
                    Click here to enter your code.</h6>
            </div>
        </div>
        <form action="#" id="checkoutForm" class="checkout__form">
            <div class="row">
                <div class="col-lg-8">
                    <h3 class="pb-5 text-center font-weight-bold">Address</h3>
                    <div class="row">
                        {{!-- Name  --}}
                        <div class="col-lg-6">
                            <div class="form-outline mb-3">
                                <label for="name" class="text-dark font-weight-bold">Name:</label>
                                <input type="text" name="name" id="name" class="form-control" placeholder="Name" required/>
                            </div>
                        </div>

                        <!--phoneNumber input -->
                        <div class="col-lg-6">
                            <div class="form-outline mb-3">
                                <label for="phoneNumber" class="text-dark font-weight-bold">Phone:</label>
                                <input type="text" name="phoneNumber" id="phoneNumber" class="form-control" placeholder="Phone" required>
                            </div>
                        </div>

                        {{!-- Zip --}}
                        <div class="col-lg-6">
                            <div class="form-outline mb-3">
                                <label for="zip" class="text-dark font-weight-bold">Pincode:</label>
                                <input type="text" name="zip" id="zip" class="form-control" placeholder="Pincode/Zipcode" required/>
                            </div>
                        </div>

                        <!--State input -->
                        <div class="col-lg-6">
                            <div class="form-outline mb-3">
                                <label for="state" class="text-dark font-weight-bold">State:</label>
                                <input type="text" name="state" id="state" class="form-control" placeholder="State" required>
                            </div>
                        </div>

                        {{!-- Address --}}
                        <div class="col-lg-6">
                            <div class="form-outline mb-3">
                                <label for="address" class="text-dark font-weight-bold">Address:</label>
                                <input type="text" name="address" id="address" class="form-control" placeholder="Address" required/>
                            </div>
                        </div>

                        <!--Locality input -->
                        <div class="col-lg-6">
                            <div class="form-outline mb-3">
                                <label for="locality" class="text-dark font-weight-bold">Locality:</label>
                                <input type="text" name="locality" id="locality" class="form-control" placeholder="Locality" required>
                            </div>
                        </div>

                        {{!-- City Input --}}
                        <div class="col-lg-6">
                            <div class="form-outline mb-3">
                                <label for="city" class="text-dark font-weight-bold">City:</label>
                                <input type="text" name="city" id="city" class="form-control" placeholder="City" required>
                            </div>
                        </div>
                        {{!-- Existing addresses --}}
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="checkout__order">
                        <h5>Your order</h5>
                        <div class="checkout__order__product">
                            <ul>
                                <li>
                                    <span class="top__text">Product</span>
                                    <span class="top__text__right">Total</span>
                                </li>
                                {{#each products}}
                                    <li>{{this.product.productName}}
                                        <span>₹{{this.totalPrice}}</span>
                                    </li>
                                {{/each}}
                            </ul>
                        </div>
                        <div class="checkout__order__total">
                            <ul>
                                {{!-- <li>Subtotal <span>$ 750.0</span></li> --}}
                                <li>Total
                                    <span>₹
                                        {{totalPrice}}</span>
                                </li>
                            </ul>
                        </div>
                        <div class="checkout__order__widget">
                            {{!-- <label for="o-acc">
                                Create an acount?
                                <input type="checkbox" id="o-acc">
                                <span class="checkmark"></span>
                            </label>
                            <p>Create am acount by entering the information below. If you are a returing customer
                                login at the top of the page.</p> --}}
                            <label for="COD">
                                Cash on Delivery
                                <input type="radio" name="payment" value="COD" id="COD">
                                <span class="checkmark"></span>
                            </label>
                            <label for="UPI">
                                UPI
                                <input type="radio" name="payment" value="UPI" id="UPI">
                                <span class="checkmark"></span>
                            </label>
                        </div>
                        <button type="submit" class="site-btn">Place order</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</section>


<section class="container">
    <div class="p-3">
        <h5 class="font-weight-bold">Addresses</h5>
    </div>
    <div class="row gutters-sm">
        {{#each address}}
            <div class="col-12">
                <div class="col-sm-6 mb-3">
                    <div class="card" style="">
                        <div class="">
                            <div class="pt-2 pr-2">
                                <a class="btn btn-primary float-right" onclick="selectAddress('{{this._id}}')">Select</a>
                            </div>
                        </div>
                        <div class="card-body p-3">
                            <p class="card-title">
                                <span class="text-black font-weight-bold">{{this.name}}</span>
                            </p>

                            {{!-- PinCode  --}}
                            <p class="mb-2">
                                <span class="text-black font-weight-bold">{{this.address}},
                                    {{this.locality}},
                                    {{this.city}}
                                    ,
                                    {{this.state}}
                                    -
                                    {{this.zip}}
                                </span>
                            </p>

                            <p class="mb-2">
                                <span class="text-black font-weight-bold">{{this.phoneNumber}}</span>
                            </p>
                        </div>

                        <div class="row">
                            {{!-- <div class="col-6">
                            <a href="#" data-target="#editAddress" data-id="{{this._id}}" data-toggle="modal" class="text-info">Edit</a>
                        </div>
                        <div class="col-6">
                            <a href="#" onclick="deleteAddress('{{this._id}}')" class="text-danger">Delete</a>
                        </div> --}}
                        </div>
                    </div>
                </div>
            </div>
        {{/each}}
    </div>
</section>

<!-- Checkout Section End -->

<!-- Instagram Begin -->
<div class="instagram">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                <div class="instagram__item set-bg" data-setbg="img/instagram/insta-1.jpg">
                    <div class="instagram__text">
                        <i class="fa fa-instagram"></i>
                        <a href="#">@ ashion_shop</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                <div class="instagram__item set-bg" data-setbg="img/instagram/insta-2.jpg">
                    <div class="instagram__text">
                        <i class="fa fa-instagram"></i>
                        <a href="#">@ ashion_shop</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                <div class="instagram__item set-bg" data-setbg="img/instagram/insta-3.jpg">
                    <div class="instagram__text">
                        <i class="fa fa-instagram"></i>
                        <a href="#">@ ashion_shop</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                <div class="instagram__item set-bg" data-setbg="img/instagram/insta-4.jpg">
                    <div class="instagram__text">
                        <i class="fa fa-instagram"></i>
                        <a href="#">@ ashion_shop</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                <div class="instagram__item set-bg" data-setbg="img/instagram/insta-5.jpg">
                    <div class="instagram__text">
                        <i class="fa fa-instagram"></i>
                        <a href="#">@ ashion_shop</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-4 col-sm-4 p-0">
                <div class="instagram__item set-bg" data-setbg="img/instagram/insta-6.jpg">
                    <div class="instagram__text">
                        <i class="fa fa-instagram"></i>
                        <a href="#">@ ashion_shop</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Instagram End -->

<!-- Footer Section Begin -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-6 col-sm-7">
                <div class="footer__about">
                    <div class="footer__logo">
                        <a href="./index.html"><img src="img/logo.png" alt=""></a>
                    </div>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
                                                                                                                                                                                                                        cilisis.</p>
                    <div class="footer__payment">
                        <a href="#"><img src="img/payment/payment-1.png" alt=""></a>
                        <a href="#"><img src="img/payment/payment-2.png" alt=""></a>
                        <a href="#"><img src="img/payment/payment-3.png" alt=""></a>
                        <a href="#"><img src="img/payment/payment-4.png" alt=""></a>
                        <a href="#"><img src="img/payment/payment-5.png" alt=""></a>
                    </div>
                </div>
            </div>
            <div class="col-lg-2 col-md-3 col-sm-5">
                <div class="footer__widget">
                    <h6>Quick links</h6>
                    <ul>
                        <li><a href="#">About</a></li>
                        <li><a href="#">Blogs</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-2 col-md-3 col-sm-4">
                <div class="footer__widget">
                    <h6>Account</h6>
                    <ul>
                        <li><a href="#">My Account</a></li>
                        <li><a href="#">Orders Tracking</a></li>
                        <li><a href="#">Checkout</a></li>
                        <li><a href="#">Wishlist</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-4 col-md-8 col-sm-8">
                <div class="footer__newslatter">
                    <h6>NEWSLETTER</h6>
                    <form action="#">
                        <input type="text" placeholder="Email">
                        <button type="submit" class="site-btn">Subscribe</button>
                    </form>
                    <div class="footer__social">
                        <a href="#">
                            <i class="fa fa-facebook"></i>
                        </a>
                        <a href="#">
                            <i class="fa fa-twitter"></i>
                        </a>
                        <a href="#">
                            <i class="fa fa-youtube-play"></i>
                        </a>
                        <a href="#">
                            <i class="fa fa-instagram"></i>
                        </a>
                        <a href="#">
                            <i class="fa fa-pinterest"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div
                class="col-lg-12">
                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                <div class="footer__copyright__text">
                    <p>Copyright &copy;
                        <script>
                            document.write(new Date().getFullYear());
                        </script>
                        All rights reserved | This template
                                                                                                                                                                                                                        is made with
                        <i class="fa fa-heart" aria-hidden="true"></i>
                        by
                        <a href="https://colorlib.com" target="_blank">Colorlib</a>
                    </p>
                </div>
                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </div>
        </div>
    </div>
</footer>
<!-- Footer Section End -->

<!-- Search Begin -->
<div class="search-model">
    <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch">+</div>
        <form class="search-model-form">
            <input type="text" id="search-input" placeholder="Search here.....">
        </form>
    </div>
</div>
<!-- Search End -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    $(document).ready(() => {
        jQuery.validator.addMethod("lettersOnly", (value) => {
            return /^[a-zA-Z ]+$/i.test(value);
        });

        $('#form').validate({
            rules: {
                name: {
                    required: true,
                    lettersOnly: true
                },
                phoneNumber: {
                    required: true,
                    minlength: 10,
                    maxlength: 10,
                    number: true
                },
                zip: {
                    required: true
                },
                state: {
                    required: true,
                    lettersOnly: true
                },
                address: {
                    required: true
                },
                locality: {
                    required: true
                },
                city: {
                    required: true
                },
                payment: {
                    required: true
                }
            },
            messages: {
                name: {
                    required: "Please enter your name!",
                    lettersOnly: "Please enter valid name!"
                },
                phoneNumber: {
                    required: "Please enter your phone number!",
                    minlength: "Invalid Number!",
                    maxlength: "Invalid Number!",
                    number: "Invalid Number!"
                },
                zip: {
                    required: "This is a required field!"
                },
                state: {
                    required: "This is a required field!",
                    lettersOnly: "Please enter valid data!"
                },
                address: {
                    required: "This is a required field!"
                },
                locality: {
                    required: "This is a required field!"
                },
                city: {
                    required: "This is a required field!"
                },
                payment: {
                    required: "Please select your payment option."
                }
            }
        })
    })


    $('#checkoutForm').submit((e) => {
        e.preventDefault()

        $.ajax({
            url: '/placeOrder',
            method: 'post',
            data: $('#checkoutForm').serialize(),
            success: (response) => {
                if (response.codSuccess) {
                    window.location.replace(response.url)
                } else {
                    razorpayPayment(response)
                }
            }
        })
    })

    function razorpayPayment(order) {
        var options = {
            "key": "rzp_test_q8bY4ubFwUmMoO", // Enter the Key ID generated from the Dashboard
            "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
            "currency": "INR",
            "name": "eCart",
            "description": "Test Transaction",
            "image": "https://example.com/your_logo",
            "order_id": order.id, // This is a sample Order ID. Pass the `id` obtained in the response of Step 1
            "handler": function (response) {
                verifyPayment(response, order);
            },
            "prefill": {
                "name": "Gaurav Kumar",
                "email": "gaurav.kumar@example.com",
                "contact": "9999999999"
            },
            "notes": {
                "address": "Razorpay Corporate Office"
            },
            "theme": {
                "color": "#3399cc"
            }
        };
        const rzp1 = new Razorpay(options);
        rzp1.open();

        rzp1.on('payment.failed', function (response) {
            
        });

    }

    function verifyPayment(payment, order) {
        $.ajax({
            url: '/verifyPayment',
            method: 'post',
            data: {
                payment,
                order
            },
            success: (response) => {
                if (response.status) {
                    window.location.replace(response.url)
                }
            }
        })
    }
</script>


{{!-- 
            alert(response.error.code);
            alert(response.error.source);
            alert(response.error.step);
            alert(response.error.reason);
            alert(response.error.metadata.order_id);
            alert(response.error.metadata.payment_id); --}}
